{% extends "base.html" %}
{% block content %}

<h1>Spectacles pour enfants</h1>

<!-- Filtres + tri -->
<form method="get" class="filters">
  <input type="text" name="q" value="{{ q }}" placeholder="ğŸ” Rechercher (titre, lieu, compagnieâ€¦)" />

  <select name="ville">
    <option value="">Toutes les villes</option>
    {% for v in villes %}
      <option value="{{ v }}" {% if v == ville_sel %}selected{% endif %}>{{ v }}</option>
    {% endfor %}
  </select>

  <select name="age">
    <option value="">Tous Ã¢ges</option>
    {% for a in ages %}
      <option value="{{ a }}" {% if a == age_sel %}selected{% endif %}>{{ a }}</option>
    {% endfor %}
  </select>

  <input type="date" name="date_from" value="{{ date_from }}" />
  <span class="filters-sep">â†’</span>
  <input type="date" name="date_to" value="{{ date_to }}" />

  <select name="sort" title="Tri">
    <option value="date_asc"  {% if sort == 'date_asc'  %}selected{% endif %}>Date â†‘</option>
    <option value="date_desc" {% if sort == 'date_desc' %}selected{% endif %}>Date â†“</option>
  </select>

  <button class="btn" type="submit">Appliquer</button>
  <a class="btn btn-clear" href="{{ url_for('home') }}">RÃ©initialiser</a>
</form>

<p class="muted" style="margin:.4rem 0 1rem">
  Producteurs : utilisez le bouton â€œ+ Annoncer un spectacleâ€.
</p>

{% if spectacles %}
  <div class="liste-spectacles">
    {% for s in spectacles %}
      <div class="carte">
        <div class="media {% if not s.image %}skeleton{% endif %}">
          {% if s.image %}
            <img src="{{ s.image }}" alt="affiche de {{ s.titre }}" loading="lazy" referrerpolicy="no-referrer">
          {% else %}
            <img src="{{ url_for('static', filename='default.jpg') }}" alt="affiche par dÃ©faut" loading="lazy">
          {% endif %}
          {% if s.date %}<div class="badge-date">{{ s.date }}</div>{% endif %}
        </div>

        <div class="body">
          <h2>{{ s.titre }}</h2>

          <div class="meta-row">
            {% if s.compagnie %}<span class="meta-chip">ğŸ‘¥ {{ s.compagnie }}</span>{% endif %}
            {% if s.lieu %}<span class="meta-chip">ğŸ“ {{ s.lieu }}</span>{% endif %}
            {% if s.age %}<span class="meta-chip">ğŸ¯ {{ s.age }}</span>{% endif %}
            {% if s.prix %}<span class="meta-chip">ğŸ’¶ {{ s.prix }}</span>{% endif %}
          </div>

          {% if s.description %}<p class="desc">{{ s.description }}</p>{% endif %}
        </div>

        <div class="actions">
          {% if s.site %}
            <a class="btn-link" href="{{ s.site }}" target="_blank" rel="noopener">Billetterie / site</a>
          {% else %}
            <span class="meta" style="color:var(--muted)">Pas de lien</span>
          {% endif %}

          <div style="display:flex; gap:.5rem">
            <a class="btn" href="{{ url_for('modifier', index=loop.index0) }}">Modifier</a>
            <form method="post" action="{{ url_for('supprimer', index=loop.index0) }}" onsubmit="return confirm('Supprimer cette annonce ?');">
              <button class="btn-danger" type="submit">Supprimer</button>
            </form>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p>Aucun spectacle ne correspond Ã  ces filtres. <a href="{{ url_for('home') }}">RÃ©initialiser</a></p>
{% endif %}

{% endblock %}
