{% extends "base.html" %}
{% block title %}Spectacles de marionnettes - AnimatoSpectacle{% endblock %}
{% block content %}

<h1>Spectacles de marionnettes</h1>

<p style="margin-bottom:24px;">
  D√©couvrez nos <strong>spectacles de marionnettes</strong> pour tous les √¢ges. 
  Marionnettes √† fils, √† gaine, marottes, ombres chinoises... Des spectacles 
  po√©tiques et enchanteurs pour √©merveiller v√òtre public.
</p>

{% if shows %}
<div class="cards">
  {% for show in shows %}
  <article class="card">
    <a href="{{ url_for('demande_animation') }}" class="media-link">
      <div class="media">
        {% set images = show.get_all_images() %}
        {% if images|length > 1 %}
          <div class="card-carousel" data-carousel>
            <div class="carousel-slides">
              {% for img in images %}
              <div class="carousel-slide">
                <img src="{{ url_for('uploaded_file', filename=img) }}" alt="{{ show.title }}{% if loop.index > 1 %} - Photo {{ loop.index }}{% endif %}">
              </div>
              {% endfor %}
            </div>
            <span class="photo-count">{{ images|length }} üì∑</span>
            <div class="carousel-indicators">
              {% for img in images %}
              <span class="carousel-indicator{% if loop.first %} active{% endif %}" data-slide="{{ loop.index0 }}"></span>
              {% endfor %}
            </div>
            <button class="carousel-nav carousel-prev" aria-label="Photo pr√©c√©dente">‚Äπ</button>
            <button class="carousel-nav carousel-next" aria-label="Photo suivante">‚Ä∫</button>
          </div>
        {% elif show.has_image() %}
          <img src="{{ url_for('uploaded_file', filename=show.file_name) }}" alt="{{ show.title }}">
        {% elif show.is_pdf() %}
          <div class="pdf-thumb">
            <a href="{{ url_for('uploaded_file', filename=show.file_name) }}" target="_blank" rel="noopener">PDF</a>
          </div>
        {% else %}
          <div class="placeholder">Aucun fichier</div>
        {% endif %}
      </div>
    </a>

    <a href="{{ url_for('show_detail', show_id=show.id) }}" class="content-link">
      <div class="content">
        {% if show.raison_sociale %}<p class="meta" style="font-weight:600; margin-bottom:8px; color:var(--primary);">{{ show.raison_sociale|title }}</p>{% endif %}
        <h3>{{ show.title }}</h3>
        <p class="meta">
          {% if show.age_range %}<span class="badge-age">{{ show.age_range|format_age }}</span>{% endif %}
          {% if show.category %} ‚Ä¢ {{ show.category|title }}{% endif %}
          {% if show.location %} ‚Ä¢ {{ show.location }}{% endif %}
        </p>
        {% if show.description %}<p class="desc">{{ show.description }}</p>{% endif %}
        {% if show.contact_email %}<p class="meta">Contact : {{ show.contact_email }}</p>{% endif %}
      </div>
    </a>
  </article>
  {% endfor %}
</div>
{% else %}
<div style="padding:24px; background:#f8f9fa; border-radius:8px; text-align:center;">
  <p style="margin:0; font-size:16px;">Aucun spectacle de marionnettes n'est disponible pour le moment.</p>
  <p style="margin:12px 0 0 0;">N'h√©sitez pas √† <a href="{{ url_for('demande_animation') }}" style="color:var(--primary); font-weight:600;">nous contacter</a> pour vos besoins sp√©cifiques ou consultez nos <a href="{{ url_for('home') }}" style="color:var(--primary); font-weight:600;">autres spectacles</a>.</p>
</div>

<script>
(function() {
  document.querySelectorAll('[data-carousel]').forEach(function(carousel) {
    const slides = carousel.querySelector('.carousel-slides');
    const indicators = carousel.querySelectorAll('.carousel-indicator');
    const prevBtn = carousel.querySelector('.carousel-prev');
    const nextBtn = carousel.querySelector('.carousel-next');
    const totalSlides = carousel.querySelectorAll('.carousel-slide').length;
    let currentSlide = 0;
    let autoPlayInterval = null;

    function goToSlide(index) {
      if (index < 0) index = totalSlides - 1;
      if (index >= totalSlides) index = 0;
      currentSlide = index;
      slides.style.transform = 'translateX(-' + (currentSlide * 100) + '%)';
      indicators.forEach(function(ind, i) {
        ind.classList.toggle('active', i === currentSlide);
      });
    }

    function nextSlide() { goToSlide(currentSlide + 1); }
    function prevSlide() { goToSlide(currentSlide - 1); }
    function startAutoPlay() {
      if (autoPlayInterval) clearInterval(autoPlayInterval);
      autoPlayInterval = setInterval(nextSlide, 45000);
    }
    function stopAutoPlay() {
      if (autoPlayInterval) { clearInterval(autoPlayInterval); autoPlayInterval = null; }
    }

    if (prevBtn) prevBtn.addEventListener('click', function(e) { e.preventDefault(); e.stopPropagation(); prevSlide(); startAutoPlay(); });
    if (nextBtn) nextBtn.addEventListener('click', function(e) { e.preventDefault(); e.stopPropagation(); nextSlide(); startAutoPlay(); });
    indicators.forEach(function(indicator, i) {
      indicator.addEventListener('click', function(e) { e.preventDefault(); e.stopPropagation(); goToSlide(i); startAutoPlay(); });
    });
    startAutoPlay();
    carousel.addEventListener('mouseenter', stopAutoPlay);
    carousel.addEventListener('mouseleave', startAutoPlay);
  });
})();
</script>
{% endif %}

{% endblock %}
