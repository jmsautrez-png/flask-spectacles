{% extends "base.html" %}
{% block title %}Accueil ‚Äî Spectacles{% endblock %}
{% block content %}

<form action="" method="get"
      style="display:flex; align-items:center; gap:12px; background:#f2f3f7; padding:10px 14px; border-radius:24px; margin:0 0 16px;">
  
  <span aria-hidden="true">üîç</span>
  <input name="q" value="{{ q or '' }}" 
         placeholder="Rechercher un spectacle, une ville, un √¢ge..."
         style="flex:1; border:none; background:transparent; outline:none; font-size:16px;">

  <button type="submit"
          style="border:none; background:transparent; font-weight:600; cursor:pointer;">OK</button>
</form>

<h2>Liste des spectacles</h2>

<div class="cards">
  {% for show in shows or [] %}
  <article class="card">
    <a href="{{ url_for('demande_animation') }}" class="media-link">
      <div class="media">
        {% if show.has_image() %}
          <img src="{{ url_for('uploaded_file', filename=show.file_name) }}" alt="{{ show.title }}">
        {% elif show.is_pdf() %}
          <a class="pdf-thumb" href="{{ url_for('uploaded_file', filename=show.file_name) }}" target="_blank">PDF</a>
        {% else %}
          <div class="placeholder">Aucun fichier</div>
        {% endif %}
      </div>
    </a>

    <a href="{{ url_for('show_detail', show_id=show.id) }}" class="content-link">
      <div class="content">
        {% if show.raison_sociale %}<p class="meta" style="font-weight:600; margin-bottom:8px; color:var(--primary);">{{ show.raison_sociale }}</p>{% endif %}
        <h3>{{ show.title }}</h3>
        <p class="meta">
          {{ show.category }}
          {% if show.location %} ‚Ä¢ {{ show.location }}{% endif %}
          {% if show.age_range %} ‚Ä¢ {{ show.age_range }}{% endif %}
        </p>
        {% if show.description %}<p class="desc">{{ show.description }}</p>{% endif %}
        {% if show.contact_email %}<p class="meta">Contact : {{ show.contact_email }}</p>{% endif %}
        {% if not show.approved %}<p class="meta" style="color:#ffb347;">(En attente de validation)</p>{% endif %}
      </div>
    </a>

    {% if user and user.is_admin %}
      <div class="actions">
        <a href="{{ url_for('show_edit', show_id=show.id) }}">Modifier</a>

        <form action="{{ url_for('show_delete', show_id=show.id) }}" method="post"
              onsubmit="return confirm('Supprimer cette annonce ?');">
          <button type="submit" class="danger">Supprimer</button>
        </form>

        {% if not show.approved %}
          <form action="{{ url_for('show_approve', show_id=show.id) }}" method="post">
            <button type="submit">‚úÖ Valider</button>
          </form>
        {% endif %}
      </div>
    {% endif %}
  </article>
  {% endfor %}
</div>

{% endblock %}
