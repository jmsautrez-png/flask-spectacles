{% extends "base.html" %}
{% block title %}Compl√©ter le spectacle - AnimatoSpectacle{% endblock %}
{% block content %}
<h2>Compl√©ter le spectacle</h2>
<form method="post" enctype="multipart/form-data" class="form">
  <label>Raison sociale
    <input type="text" name="raison_sociale" value="{{ show.raison_sociale or '' }}">
  </label>

  <label>Titre
    <input type="text" name="title" value="{{ show.title }}" required>
  </label>

  <label>Description (max 200 mots)
    <textarea id="description" name="description" rows="4" required>{{ show.description or "" }}</textarea>
    <div id="desc-counter" style="font-size:.9rem;opacity:.8;margin-top:4px;">0/200 mots</div>
  </label>

  <div class="grid-2">
      <label>Ville
        <input type="text" name="location" value="{{ show.location }}">
      </label>
      <label>R√©gion
        <input type="text" name="region" value="{{ show.region or '' }}" placeholder="Ex: √éle-de-France, Bretagne...">
      </label>
   </div>

  <label>Cat√©gorie
    <input type="text" name="category" value="{{ show.category }}">
  </label>

  <!-- Champ cat√©gorie 2 supprim√© (nettoy√©) -->
   
  <label>√Çge
    <select name="age_range" required>
      <option value="">-- Choisir --</option>
      <option value="enfant" {% if (request.form.get('age_range') if request.method=='POST' else (show.age_range if show else '')) == 'enfant' %}selected{% endif %}>Enfant</option>
      <option value="adulte" {% if (request.form.get('age_range') if request.method=='POST' else (show.age_range if show else '')) == 'adulte' %}selected{% endif %}>Adulte</option>
      <option value="tout public" {% if (request.form.get('age_range') if request.method=='POST' else (show.age_range if show else '')) == 'tout public' %}selected{% endif %}>Tout public</option>
    </select>
  </label>

  <label>Site internet
    <input type="url" name="site_internet" placeholder="https://www.monsite.fr" value="{{ show.site_internet if show and show.site_internet else '' }}">
    <span style="font-size:0.95rem;color:#fff;font-weight:bold;display:block;margin-top:2px;">(visible si abonnement)</span>
  </label>

  <label>Email de contact <span style="font-size:0.85rem;font-weight:normal;color:var(--muted);">(Modifiable uniquement par l'admin)</span>
    <input type="email" name="contact_email" value="{{ show.contact_email or 'audition_2020@yahoo.fr' }}">
    <span style="font-size:0.95rem;color:#fff;font-weight:bold;display:block;margin-top:2px;">(visible si abonnement)</span>
  </label>

  <label>T√©l√©phone de contact <span style="font-size:0.85rem;font-weight:normal;color:var(--muted);">(visible uniquement par l'administrateur)</span>
    <input type="tel" name="contact_phone" value="{{ show.contact_phone or '' }}" placeholder="06 12 34 56 78">
  </label>

  {% if show.file_name %}
    {% if show.is_pdf() %}
        <p>Fichier actuel :
            <a href="{{ url_for('static', filename='upload/' ~ show.file_name) }}" target="_blank">
                üìÑ Voir le PDF ({{ show.file_name }})
            </a>
        </p>
    {% else %}
        <p>Image actuelle :</p>
        <img src="{{ url_for('static', filename='upload/' ~ show.file_name) }}"
             alt="{{ show.title }}"
             class="show-image">
    {% endif %}
{% else %}
    <p><em>Aucun fichier associ√© pour l‚Äôinstant.</em></p>
{% endif %}



  <label>Remplacer l'image ou le PDF <span style="font-size:0.85rem;font-weight:normal;color:var(--muted);">(Taille max : 5 MB)</span>
    <input type="file" name="file" accept=".png,.jpg,.jpeg,.gif,.webp,.pdf">
  </label>

  <div class="actions">
    <button type="submit">Mettre √† jour</button>
    <a class="btn-secondary" href="{{ url_for('home') }}">Annuler</a>
    <a class="btn-secondary" href="{{ url_for('company_dashboard') }}" style="margin-left:8px;">Retour au tableau de bord</a>
  </div>
</form>


<!-- Script limite 200 mots -->
<script>
(function () {
  const ta = document.getElementById('description');
  const counter = document.getElementById('desc-counter');
  const MAX = 200;

  if (!ta || !counter) return;

  function update() {
    const words = ta.value.trim().split(/\s+/).filter(Boolean);
    if (words.length > MAX) {
      ta.value = words.slice(0, MAX).join(' ');
    }
    const count = ta.value.trim() ? ta.value.trim().split(/\s+/).length : 0;
    counter.textContent = `${count}/${MAX} mots`;
  }

  ta.addEventListener('input', update);
  update(); // initialiser le compteur

  document.querySelectorAll("form").forEach(form => {
    form.addEventListener("submit", e => {
      const words = ta.value.trim().split(/\s+/).filter(Boolean);
      if (words.length > MAX) {
        e.preventDefault();
        alert("La description ne doit pas d√©passer 70 mots.");
      }
    });
  });
})();
</script>
{% endblock %}
