{% extends "base.html" %}
{% block title %}Demande de spectacle p√©dagogique - {{ theme_label }} - Spectacle'ment V√òtre{% endblock %}

{% block meta_description %}Formulaire de demande de spectacle ou animation p√©dagogique pour votre √©cole. Th√®me : {{ theme_label }}. Accompagnement personnalis√©.{% endblock %}

{% block content %}
<style>
  .demande-ecole-wrap {
    background: linear-gradient(135deg, #1b2a4e 0%, #355c7d 100%);
    border: 2px solid #355c7d;
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 32px;
    color: #fff;
  }
  
  .demande-header {
    background: linear-gradient(90deg, #1a237e 0%, #283e5e 100%);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
    text-align: center;
  }
  
  .demande-header h1 {
    margin: 0 0 10px 0;
    font-size: 1.4rem;
    color: #fff;
  }
  
  .demande-header .theme-badge {
    display: inline-block;
    background: #ffc107;
    color: #000;
    padding: 8px 20px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 1.1rem;
  }
  
  .demande-section {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
  }
  
  .demande-section legend {
    color: #ffc107;
    font-weight: 700;
    font-size: 1.1rem;
    padding: 0 10px;
  }
  
  .grid-2 {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
  
  .grid-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
  }
  
  @media (max-width: 600px) {
    .grid-2, .grid-3 {
      grid-template-columns: 1fr;
    }
    
    .demande-ecole-wrap {
      padding: 18px;
    }
  }
  
  label {
    display: block;
    margin-bottom: 16px;
  }
  
  .label-text {
    display: block;
    margin-bottom: 6px;
    font-weight: 600;
    color: rgba(255,255,255,0.9);
  }
  
  .req {
    color: #ff6b6b;
  }
  
  @keyframes pulse-empty {
    0%, 100% { 
      box-shadow: 0 0 0 0 rgba(255, 82, 82, 0);
      border-color: rgba(255, 82, 82, 0.4);
    }
    50% { 
      box-shadow: 0 0 12px 3px rgba(255, 82, 82, 0.5);
      border-color: rgba(255, 82, 82, 0.8);
    }
  }
  
  .field-empty {
    animation: pulse-empty 2s ease-in-out infinite;
  }
  
  .field-filled {
    animation: none;
    border-color: rgba(76, 175, 80, 0.5) !important;
    box-shadow: none;
  }
  
  input[type="text"],
  input[type="email"],
  input[type="tel"],
  input[type="number"],
  select,
  textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 8px;
    background: rgba(0,0,0,0.3);
    color: #fff;
    font-size: 15px;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  
  input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: #ffc107;
    animation: none;
  }
  
  .hint {
    display: block;
    margin-top: 4px;
    font-size: 0.85rem;
    color: rgba(255,255,255,0.6);
  }
  
  .checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 10px;
  }
  
  .checkbox-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 14px;
    background: rgba(255,255,255,0.1);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .checkbox-item:hover {
    background: rgba(255,255,255,0.15);
  }
  
  .checkbox-item input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: #ffc107;
  }
  
  .sous-themes-section {
    background: rgba(255,193,7,0.1);
    border: 1px solid rgba(255,193,7,0.3);
    border-radius: 10px;
    padding: 15px;
    margin-top: 15px;
  }
  
  .sous-themes-section h4 {
    color: #ffc107;
    margin: 0 0 12px 0;
    font-size: 1rem;
  }
  
  .radio-group {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }
  
  .radio-item {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 14px;
    background: rgba(255,255,255,0.1);
    border-radius: 8px;
    cursor: pointer;
  }
  
  .radio-item input[type="radio"] {
    accent-color: #ffc107;
  }
  
  .btn-submit {
    display: block;
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, #ffc107 0%, #ffeb3b 100%);
    color: #000;
    border: none;
    border-radius: 12px;
    font-size: 1.2rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
  }
  
  .btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(255,193,7,0.4);
  }
  
  .intro-text {
    background: rgba(255,255,255,0.1);
    border-left: 4px solid #ffc107;
    padding: 15px 20px;
    margin-bottom: 25px;
    border-radius: 0 8px 8px 0;
    font-style: italic;
  }
  
  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: rgba(255,255,255,0.8);
    text-decoration: none;
    margin-bottom: 20px;
    transition: color 0.2s;
  }
  
  .back-link:hover {
    color: #ffc107;
  }
</style>

<a href="{{ url_for('ecoles_themes') }}" class="back-link">
  ‚Üê Retour aux th√®mes
</a>

<div class="demande-ecole-wrap">
  <div class="demande-header">
    <h1>üìù Demande de spectacle p√©dagogique</h1>
    <span class="theme-badge">{{ theme_emoji }} {{ theme_label }}</span>
  </div>
  
  <div class="intro-text">
    Ce questionnaire nous permet de comprendre pr√©cis√©ment votre projet p√©dagogique 
    afin de vous proposer la solution artistique la plus adapt√©e.
  </div>

  <form action="{{ url_for('demande_ecole') }}" method="POST" novalidate>
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <input type="hidden" name="auto_datetime" id="auto_datetime" value="">
    <input type="hidden" name="theme_principal" value="{{ theme }}">
    
    <!-- Section 1: Informations sur l'√©cole -->
    <fieldset class="demande-section">
      <legend>1Ô∏è‚É£ Votre √©tablissement</legend>
      
      <div class="grid-2">
        <label>
          <span class="label-text">Nom de l'√©cole <span class="req">*</span></span>
          <input type="text" name="nom_ecole" required placeholder="√âcole maternelle / primaire..."
                 value="{{ request.form.get('nom_ecole', '') }}">
        </label>
        
        <label>
          <span class="label-text">Type d'√©tablissement <span class="req">*</span></span>
          <select name="type_etablissement" required>
            <option value="">-- Choisir --</option>
            <option value="Maternelle" {{ 'selected' if request.form.get('type_etablissement') == 'Maternelle' }}>Maternelle</option>
            <option value="Primaire" {{ 'selected' if request.form.get('type_etablissement') == 'Primaire' }}>Primaire (√©l√©mentaire)</option>
            <option value="Maternelle et Primaire" {{ 'selected' if request.form.get('type_etablissement') == 'Maternelle et Primaire' }}>Maternelle et Primaire</option>
            <option value="Mairie" {{ 'selected' if request.form.get('type_etablissement') == 'Mairie' }}>Mairie</option>
            <option value="MJC" {{ 'selected' if request.form.get('type_etablissement') == 'MJC' }}>MJC</option>
            <option value="CLSH" {{ 'selected' if request.form.get('type_etablissement') == 'CLSH' }}>CLSH</option>
          </select>
        </label>
      </div>
      
      <label>
        <span class="label-text">Adresse de l'√©cole</span>
        <input type="text" name="adresse" placeholder="Num√©ro et rue..."
               value="{{ request.form.get('adresse', '') }}">
      </label>
      
      <div class="grid-2">
        <label>
          <span class="label-text">Code postal <span class="req">*</span></span>
          <input type="text" name="code_postal" required id="code_postal"
                 pattern="[0-9]{5}" maxlength="5" inputmode="numeric"
                 placeholder="Ex: 75001"
                 value="{{ request.form.get('code_postal', '') }}">
        </label>
        
        <label>
          <span class="label-text">Ville <span class="req">*</span></span>
          <input type="text" name="ville" required placeholder="Ville..."
                 value="{{ request.form.get('ville', '') }}">
        </label>
      </div>
      
      <label>
        <span class="label-text">R√©gion</span>
        <input type="text" name="region" id="region" readonly
               placeholder="D√©termin√©e automatiquement"
               value="{{ request.form.get('region', '') }}"
               style="background: rgba(0,0,0,0.5); cursor: not-allowed;">
      </label>
    </fieldset>
    
    <!-- Section 2: Contact -->
    <fieldset class="demande-section">
      <legend>2Ô∏è‚É£ Personne contact</legend>
      
      <div class="grid-2">
        <label>
          <span class="label-text">Nom et pr√©nom <span class="req">*</span></span>
          <input type="text" name="nom_contact" required placeholder="Votre nom..."
                 value="{{ request.form.get('nom_contact', '') }}">
        </label>
        
        <label>
          <span class="label-text">Fonction</span>
          <select name="fonction_contact">
            <option value="">-- Choisir --</option>
            <option value="Directeur/Directrice" {{ 'selected' if request.form.get('fonction_contact') == 'Directeur/Directrice' }}>Directeur/Directrice</option>
            <option value="Enseignant(e)" {{ 'selected' if request.form.get('fonction_contact') == 'Enseignant(e)' }}>Enseignant(e)</option>
            <option value="Parent d'√©l√®ve" {{ 'selected' if request.form.get('fonction_contact') == "Parent d'√©l√®ve" }}>Parent d'√©l√®ve</option>
            <option value="ATSEM" {{ 'selected' if request.form.get('fonction_contact') == 'ATSEM' }}>ATSEM</option>
            <option value="Maire" {{ 'selected' if request.form.get('fonction_contact') == 'Maire' }}>Maire</option>
            <option value="√âlu(e)" {{ 'selected' if request.form.get('fonction_contact') == '√âlu(e)' }}>√âlu(e)</option>
            <option value="Autre" {{ 'selected' if request.form.get('fonction_contact') == 'Autre' }}>Autre</option>
          </select>
        </label>
      </div>
      
      <div class="grid-2">
        <label>
          <span class="label-text">Email <span class="req">*</span></span>
          <input type="email" name="email" required placeholder="votre@email.fr"
                 value="{{ request.form.get('email', '') }}">
        </label>
        
        <label>
          <span class="label-text">T√©l√©phone <span class="req">*</span></span>
          <input type="tel" name="telephone" required inputmode="tel"
                 placeholder="06 00 00 00 00"
                 value="{{ request.form.get('telephone', '') }}">
        </label>
      </div>
    </fieldset>
    
    <!-- Section 3: Classes concern√©es -->
    <fieldset class="demande-section">
      <legend>3Ô∏è‚É£ Classes concern√©es</legend>
      
      <div class="grid-2">
        <label>
          <span class="label-text">Nombre de classes</span>
          <input type="text" name="nombre_classes" placeholder="Ex: 5"
                 value="{{ request.form.get('nombre_classes', '') }}">
        </label>
        
        <label>
          <span class="label-text">Nombre d'√©l√®ves (approximatif)</span>
          <input type="text" name="nombre_eleves" placeholder="Ex: 120"
                 value="{{ request.form.get('nombre_eleves', '') }}">
        </label>
      </div>
      
      <label>
        <span class="label-text">Niveaux concern√©s</span>
        <div class="checkbox-group">
          <label class="checkbox-item">
            <input type="checkbox" name="niveaux" value="PS"> PS
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="niveaux" value="MS"> MS
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="niveaux" value="GS"> GS
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="niveaux" value="CP"> CP
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="niveaux" value="CE1"> CE1
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="niveaux" value="CE2"> CE2
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="niveaux" value="CM1"> CM1
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="niveaux" value="CM2"> CM2
          </label>
        </div>
      </label>
    </fieldset>
    
    <!-- Section 4: Th√®me et objectifs -->
    <fieldset class="demande-section">
      <legend>4Ô∏è‚É£ Objectifs p√©dagogiques</legend>
      
      <p style="color: rgba(255,255,255,0.8); margin-bottom: 15px;">
        Th√®me s√©lectionn√© : <strong style="color: #ffc107;">{{ theme_label }}</strong>
      </p>
      
      <!-- Sous-th√®mes conditionnels selon le th√®me -->
      {% if theme == 'ecologie' %}
      <div class="sous-themes-section">
        <h4>üåç Pr√©cisez les aspects √©cologiques qui vous int√©ressent :</h4>
        <div class="checkbox-group">
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Protection de la nature"> Protection de la nature</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Tri des d√©chets"> Tri des d√©chets</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="√âconomie d'√©nergie"> √âconomie d'√©nergie</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Biodiversit√©"> Biodiversit√©</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Eau & ressources naturelles"> Eau & ressources naturelles</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Consommation responsable"> Consommation responsable</label>
        </div>
      </div>
      {% elif theme == 'vivre-ensemble' %}
      <div class="sous-themes-section">
        <h4>ü§ù Pr√©cisez les aspects du vivre ensemble :</h4>
        <div class="checkbox-group">
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Pr√©vention du harc√®lement"> Pr√©vention du harc√®lement</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Respect & tol√©rance"> Respect & tol√©rance</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Empathie"> Empathie</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Gestion des conflits"> Gestion des conflits</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Valeurs citoyennes"> Valeurs citoyennes</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Inclusion"> Inclusion</label>
        </div>
      </div>
      {% elif theme == 'cultures-monde' %}
      <div class="sous-themes-section">
        <h4>üåê Pr√©cisez les aspects culturels :</h4>
        <div class="checkbox-group">
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Musiques du monde"> Musiques du monde</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Contes traditionnels"> Contes traditionnels</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Danses"> Danses</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="D√©couverte des pays"> D√©couverte des pays</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Instruments"> Instruments</label>
        </div>
      </div>
      {% elif theme == 'prevention' %}
      <div class="sous-themes-section">
        <h4>‚ù§Ô∏è Pr√©cisez les aspects pr√©vention :</h4>
        <div class="checkbox-group">
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="S√©curit√© routi√®re"> S√©curit√© routi√®re</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Hygi√®ne & sant√©"> Hygi√®ne & sant√©</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Alimentation √©quilibr√©e"> Alimentation √©quilibr√©e</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Gestion des √©motions"> Gestion des √©motions</label>
          <label class="checkbox-item"><input type="checkbox" name="sous_themes" value="Premiers secours"> Premiers secours</label>
        </div>
      </div>
      {% endif %}
      
      <label style="margin-top: 20px;">
        <span class="label-text">D√©crivez vos objectifs p√©dagogiques <span class="req">*</span></span>
        <textarea name="objectifs_pedagogiques" rows="5" required
                  placeholder="Quels sont vos objectifs ? (sensibilisation, pr√©vention, coh√©sion, apprentissages...)">{{ request.form.get('objectifs_pedagogiques', '') }}</textarea>
        <small class="hint">Soyez le plus pr√©cis possible pour que nous puissions vous proposer le spectacle id√©al.</small>
      </label>
    </fieldset>
    
    <!-- Section 5: Type d'animation -->
    <fieldset class="demande-section">
      <legend>5Ô∏è‚É£ Type d'animation souhait√©e</legend>
      
      <div class="checkbox-group">
        <label class="checkbox-item"><input type="checkbox" name="types_animation" value="Spectacle musical"> Spectacle musical</label>
        <label class="checkbox-item"><input type="checkbox" name="types_animation" value="Th√©√¢tre"> Th√©√¢tre</label>
        <label class="checkbox-item"><input type="checkbox" name="types_animation" value="Marionnettes"> Marionnettes</label>
        <label class="checkbox-item"><input type="checkbox" name="types_animation" value="Conte musical"> Conte musical</label>
        <label class="checkbox-item"><input type="checkbox" name="types_animation" value="Spectacle interactif"> Spectacle interactif</label>
        <label class="checkbox-item"><input type="checkbox" name="types_animation" value="Atelier participatif"> Atelier participatif</label>
        <label class="checkbox-item"><input type="checkbox" name="types_animation" value="Conf√©rence p√©dagogique"> Conf√©rence / √©change p√©dagogique</label>
        <label class="checkbox-item"><input type="checkbox" name="types_animation" value="Cirque"> Cirque</label>
        <label class="checkbox-item"><input type="checkbox" name="types_animation" value="Magie"> Magie</label>
      </div>
    </fieldset>
    
    <!-- Section 6: Contraintes techniques -->
    <fieldset class="demande-section">
      <legend>6Ô∏è‚É£ Contraintes techniques</legend>
      
      <div class="grid-2">
        <label>
          <span class="label-text">Salle disponible</span>
          <div class="checkbox-group">
            <label class="checkbox-item"><input type="checkbox" name="salle_disponible" value="Salle de classe"> Salle de classe</label>
            <label class="checkbox-item"><input type="checkbox" name="salle_disponible" value="Salle polyvalente"> Salle polyvalente</label>
            <label class="checkbox-item"><input type="checkbox" name="salle_disponible" value="Salle de sport"> Salle de sport</label>
            <label class="checkbox-item"><input type="checkbox" name="salle_disponible" value="Pr√©au"> Pr√©au</label>
            <label class="checkbox-item"><input type="checkbox" name="salle_disponible" value="Ext√©rieur"> Ext√©rieur</label>
          </div>
        </label>
        
        <label>
          <span class="label-text">Surface approximative (m¬≤)</span>
          <input type="text" name="surface_approximative" placeholder="Ex: 100 m¬≤"
                 value="{{ request.form.get('surface_approximative', '') }}">
        </label>
      </div>
      
      <label style="margin-top: 10px;">
        <span class="label-text">Acc√®s √©lectricit√©</span>
        <div class="radio-group">
          <label class="radio-item">
            <input type="radio" name="acces_electricite" value="1" checked> Oui
          </label>
          <label class="radio-item">
            <input type="radio" name="acces_electricite" value="0"> Non
          </label>
        </div>
      </label>
    </fieldset>
    
    <!-- Section 7: P√©riode et budget -->
    <fieldset class="demande-section">
      <legend>7Ô∏è‚É£ P√©riode & Budget</legend>
      
      <div class="grid-2">
        <label>
          <span class="label-text">P√©riode souhait√©e</span>
          <input type="text" name="periode_souhaitee" placeholder="Ex: Janvier-Mars, Semaine du go√ªt..."
                 value="{{ request.form.get('periode_souhaitee', '') }}">
        </label>
        
        <label>
          <span class="label-text">Date pr√©cise (si connue)</span>
          <input type="text" name="date_precise" placeholder="Ex: 15 mars 2026"
                 value="{{ request.form.get('date_precise', '') }}">
        </label>
      </div>
      
      <label>
        <span class="label-text">Budget approximatif</span>
        <div class="radio-group">
          <label class="radio-item"><input type="radio" name="budget" value="-500‚Ç¨"> - 500‚Ç¨</label>
          <label class="radio-item"><input type="radio" name="budget" value="500-800‚Ç¨"> 500 ‚Äì 800‚Ç¨</label>
          <label class="radio-item"><input type="radio" name="budget" value="800-1200‚Ç¨"> 800 ‚Äì 1200‚Ç¨</label>
          <label class="radio-item"><input type="radio" name="budget" value="+1200‚Ç¨"> + 1200‚Ç¨</label>
          <label class="radio-item"><input type="radio" name="budget" value="√Ä d√©finir"> √Ä d√©finir</label>
        </div>
        <small class="hint">(facultatif mais tr√®s utile)</small>
      </label>
    </fieldset>
    
    <!-- Section 8: Informations compl√©mentaires -->
    <fieldset class="demande-section">
      <legend>8Ô∏è‚É£ Informations compl√©mentaires</legend>
      
      <label>
        <span class="label-text">Contraintes particuli√®res, souhaits sp√©cifiques, exp√©riences pass√©es...</span>
        <textarea name="informations_complementaires" rows="4"
                  placeholder="Avez-vous des contraintes ou souhaits particuliers ? Avez-vous d√©j√† fait appel √† des compagnies ?">{{ request.form.get('informations_complementaires', '') }}</textarea>
      </label>
    </fieldset>
    
    <button type="submit" class="btn-submit">
      üì® Envoyer ma demande
    </button>
    
    <p style="text-align: center; margin-top: 15px; color: rgba(255,255,255,0.7); font-size: 0.9rem;">
      Votre demande sera trait√©e dans les 48h. Nous vous recontacterons avec une proposition personnalis√©e.
    </p>
  </form>
</div>

<script>
// Auto-remplir la date/heure
document.getElementById('auto_datetime').value = new Date().toLocaleString('fr-FR');

// Auto-remplir la r√©gion selon le code postal
const codePostalInput = document.getElementById('code_postal');
const regionInput = document.getElementById('region');

const departementToRegion = {
  '01': 'Auvergne-Rh√¥ne-Alpes', '03': 'Auvergne-Rh√¥ne-Alpes', '07': 'Auvergne-Rh√¥ne-Alpes',
  '15': 'Auvergne-Rh√¥ne-Alpes', '26': 'Auvergne-Rh√¥ne-Alpes', '38': 'Auvergne-Rh√¥ne-Alpes',
  '42': 'Auvergne-Rh√¥ne-Alpes', '43': 'Auvergne-Rh√¥ne-Alpes', '63': 'Auvergne-Rh√¥ne-Alpes',
  '69': 'Auvergne-Rh√¥ne-Alpes', '73': 'Auvergne-Rh√¥ne-Alpes', '74': 'Auvergne-Rh√¥ne-Alpes',
  '21': 'Bourgogne-Franche-Comt√©', '25': 'Bourgogne-Franche-Comt√©', '39': 'Bourgogne-Franche-Comt√©',
  '58': 'Bourgogne-Franche-Comt√©', '70': 'Bourgogne-Franche-Comt√©', '71': 'Bourgogne-Franche-Comt√©',
  '89': 'Bourgogne-Franche-Comt√©', '90': 'Bourgogne-Franche-Comt√©',
  '22': 'Bretagne', '29': 'Bretagne', '35': 'Bretagne', '56': 'Bretagne',
  '18': 'Centre-Val de Loire', '28': 'Centre-Val de Loire', '36': 'Centre-Val de Loire',
  '37': 'Centre-Val de Loire', '41': 'Centre-Val de Loire', '45': 'Centre-Val de Loire',
  '2A': 'Corse', '2B': 'Corse', '20': 'Corse',
  '08': 'Grand Est', '10': 'Grand Est', '51': 'Grand Est', '52': 'Grand Est',
  '54': 'Grand Est', '55': 'Grand Est', '57': 'Grand Est', '67': 'Grand Est', '68': 'Grand Est', '88': 'Grand Est',
  '02': 'Hauts-de-France', '59': 'Hauts-de-France', '60': 'Hauts-de-France', '62': 'Hauts-de-France', '80': 'Hauts-de-France',
  '75': '√éle-de-France', '77': '√éle-de-France', '78': '√éle-de-France', '91': '√éle-de-France',
  '92': '√éle-de-France', '93': '√éle-de-France', '94': '√éle-de-France', '95': '√éle-de-France',
  '14': 'Normandie', '27': 'Normandie', '50': 'Normandie', '61': 'Normandie', '76': 'Normandie',
  '16': 'Nouvelle-Aquitaine', '17': 'Nouvelle-Aquitaine', '19': 'Nouvelle-Aquitaine',
  '23': 'Nouvelle-Aquitaine', '24': 'Nouvelle-Aquitaine', '33': 'Nouvelle-Aquitaine',
  '40': 'Nouvelle-Aquitaine', '47': 'Nouvelle-Aquitaine', '64': 'Nouvelle-Aquitaine',
  '79': 'Nouvelle-Aquitaine', '86': 'Nouvelle-Aquitaine', '87': 'Nouvelle-Aquitaine',
  '09': 'Occitanie', '11': 'Occitanie', '12': 'Occitanie', '30': 'Occitanie', '31': 'Occitanie',
  '32': 'Occitanie', '34': 'Occitanie', '46': 'Occitanie', '48': 'Occitanie', '65': 'Occitanie',
  '66': 'Occitanie', '81': 'Occitanie', '82': 'Occitanie',
  '44': 'Pays de la Loire', '49': 'Pays de la Loire', '53': 'Pays de la Loire', '72': 'Pays de la Loire', '85': 'Pays de la Loire',
  '04': 'Provence-Alpes-C√¥te d\'Azur', '05': 'Provence-Alpes-C√¥te d\'Azur', '06': 'Provence-Alpes-C√¥te d\'Azur',
  '13': 'Provence-Alpes-C√¥te d\'Azur', '83': 'Provence-Alpes-C√¥te d\'Azur', '84': 'Provence-Alpes-C√¥te d\'Azur',
  '971': 'Guadeloupe', '972': 'Martinique', '973': 'Guyane', '974': 'La R√©union', '976': 'Mayotte'
};

codePostalInput.addEventListener('input', function() {
  const cp = this.value;
  if (cp.length >= 2) {
    const dept = cp.substring(0, 2);
    const deptCorse = cp.substring(0, 3);
    if (departementToRegion[deptCorse]) {
      regionInput.value = departementToRegion[deptCorse];
    } else if (departementToRegion[dept]) {
      regionInput.value = departementToRegion[dept];
    }
  }
});

// Gestion du clignotement des champs vides
function checkFieldState(field) {
  const value = field.value.trim();
  if (value === '' || value === '-- Choisir --') {
    field.classList.remove('field-filled');
    field.classList.add('field-empty');
  } else {
    field.classList.remove('field-empty');
    field.classList.add('field-filled');
  }
}

// Initialiser tous les champs du formulaire
document.addEventListener('DOMContentLoaded', function() {
  const formFields = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="number"], select, textarea');
  
  formFields.forEach(function(field) {
    // V√©rifier l'√©tat initial
    checkFieldState(field);
    
    // √âcouter les changements
    field.addEventListener('input', function() {
      checkFieldState(this);
    });
    
    field.addEventListener('change', function() {
      checkFieldState(this);
    });
    
    // Arr√™ter l'animation au focus
    field.addEventListener('focus', function() {
      this.classList.remove('field-empty');
    });
    
    // Rev√©rifier au blur
    field.addEventListener('blur', function() {
      checkFieldState(this);
    });
  });
});
</script>
{% endblock %}
