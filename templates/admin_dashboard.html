{% extends "base.html" %}
{% block title %}Tableau de bord - AnimatoSpectacle{% endblock %}

{% block content %}

<h1>Tableau de bord administrateur</h1>

<div style="margin-bottom: 24px; display: flex; justify-content: flex-end; gap: 12px;">
  <a href="{{ url_for('export_shows_xlsx') }}" class="btn btn-primary" style="padding:10px 18px; border-radius:8px; font-weight:600; background:#0d6efd; color:white; text-decoration:none;">üé≠ Exporter les spectacles (Excel)</a>
  <a href="{{ url_for('export_users_xlsx') }}" class="btn btn-success" style="padding:10px 18px; border-radius:8px; font-weight:600; background:#198754; color:white; text-decoration:none;">üë• Exporter les utilisateurs (Excel)</a>
</div>


{% if pending %}
    <div class="cards">
    {% for show in pending %}
        <article class="card" style="border-color:#e67e22;">
            <div class="media">
                {% if show.file_name %}
                    {% if show.is_pdf() %}
                        <a href="{{ url_for('uploaded_file', filename=show.file_name) }}"
                           target="_blank" class="pdf-thumb">üìÑ PDF</a>
                    {% else %}
                        <img src="{{ url_for('uploaded_file', filename=show.file_name) }}"
                             alt="{{ show.title }}">
                    {% endif %}
                {% else %}
                    <div class="placeholder">Aucun fichier</div>
                {% endif %}
            </div>

            <div class="content">
                <h3>{{ show.title }}</h3>
                <p class="meta">{{ show.category }} ‚Ä¢ {{ show.location }}</p>
                {% if show.age_range %}<p class="meta">{{ show.age_range }}</p>{% endif %}
                
                <div style="background:#1a1a1e;padding:8px;border-radius:6px;margin:8px 0;font-size:0.8rem;">
                    <div>üë§ <strong>Compagnie:</strong> {{ show.raison_sociale or 'Non renseign√©e' }}</div>
                    <div>üìç <strong>R√©gion/Ville:</strong> {{ show.location or 'Non renseign√©e' }}</div>
                    <div>üìß <strong>Email:</strong> {{ show.contact_email or 'Non renseign√©' }}</div>
                    <div>üì± <strong>T√©l√©phone:</strong> {{ show.contact_phone or 'Non renseign√©' }}</div>
                </div>
            </div>

            <div class="actions">
                <form action="{{ url_for('show_approve', show_id=show.id) }}" method="post" style="flex:1; margin:0;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button type="submit" style="width:100%; background:var(--ok); color:#fff;">Valider</button>
                </form>
                <a href="{{ url_for('show_edit', show_id=show.id) }}" style="flex:1; display:flex; align-items:center; justify-content:center;">Modifier</a>
                <form action="{{ url_for('show_delete', show_id=show.id) }}" method="post"
                      onsubmit="return confirm('Supprimer ?');" style="flex:1; margin:0;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button type="submit" class="danger" style="width:100%;">Supprimer</button>
                </form>
            </div>
        </article>
    {% endfor %}
    </div>
{% else %}
    <p style="color:var(--muted);">Aucune annonce en attente.</p>
{% endif %}

<hr>

<h2>üìö Toutes les annonces</h2>
<div class="cards">
{% for show in shows %}
    <article class="card">
        {# --------- FICHIER ASSOCI√â (IMAGE OU PDF) --------- #}
        <div class="media">
            {% if show.file_name %}
                {% if show.is_pdf() %}
                    <a href="{{ url_for('uploaded_file', filename=show.file_name) }}"
                       target="_blank"
                       class="pdf-thumb">
                        üìÑ PDF
                    </a>
                {% else %}
                    <img src="{{ url_for('uploaded_file', filename=show.file_name) }}"
                         alt="{{ show.title }}">
                {% endif %}
            {% else %}
                <div class="placeholder">Aucun fichier</div>
            {% endif %}
        </div>

        <div class="content">
            {% if show.raison_sociale %}
                <p class="meta" style="font-weight:600; color:var(--primary);">{{ show.raison_sociale }}</p>
            {% endif %}
            <h3>{{ show.title }}</h3>
            <p class="meta">{{ show.category }}</p>
            {% if show.location %}<p class="meta">üìç {{ show.location }}</p>{% endif %}

            {% if not show.approved %}
                <p class="meta" style="color:#e67e22;">‚è≥ Non valid√©e</p>
            {% else %}
                <p class="meta" style="color:#2ecc71;">‚úî Valid√©e</p>
            {% endif %}
        </div>
        
        <div class="actions">
            <a href="{{ url_for('show_edit', show_id=show.id) }}">Modifier</a>
            <form action="{{ url_for('show_delete', show_id=show.id) }}" method="post"
                  onsubmit="return confirm('Supprimer ?');" style="flex:1; margin:0;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <button type="submit" class="danger" style="width:100%;">Supprimer</button>
            </form>
        </div>
    </article>
{% endfor %}
</div>

<!-- Pagination -->
{% if pagination and pagination.pages > 1 %}
<nav class="pagination" style="margin: 30px 0; text-align: center;">
  <div style="display: inline-flex; gap: 8px; align-items: center; flex-wrap: wrap; justify-content: center;">
    
    <!-- Page pr√©c√©dente -->
    {% if pagination.has_prev %}
      <a href="{{ url_for('admin_dashboard', page=pagination.prev_num) }}"
         style="padding: 8px 12px; background: var(--primary); color: white; text-decoration: none; border-radius: 4px; font-weight: 600;">
        ‚Üê Pr√©c√©dent
      </a>
    {% else %}
      <span style="padding: 8px 12px; background: #ddd; color: #999; border-radius: 4px; font-weight: 600;">
        ‚Üê Pr√©c√©dent
      </span>
    {% endif %}

    <!-- Num√©ros de pages -->
    {% for p in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
      {% if p %}
        {% if p == pagination.page %}
          <span style="padding: 8px 12px; background: var(--primary); color: white; border-radius: 4px; font-weight: 600;">
            {{ p }}
          </span>
        {% else %}
          <a href="{{ url_for('admin_dashboard', page=p) }}"
             style="padding: 8px 12px; background: #f2f3f7; color: var(--text); text-decoration: none; border-radius: 4px; font-weight: 600;">
            {{ p }}
          </a>
        {% endif %}
      {% else %}
        <span style="padding: 8px 12px; color: #999;">...</span>
      {% endif %}
    {% endfor %}

    <!-- Page suivante -->
    {% if pagination.has_next %}
      <a href="{{ url_for('admin_dashboard', page=pagination.next_num) }}"
         style="padding: 8px 12px; background: var(--primary); color: white; text-decoration: none; border-radius: 4px; font-weight: 600;">
        Suivant ‚Üí
      </a>
    {% else %}
      <span style="padding: 8px 12px; background: #ddd; color: #999; border-radius: 4px; font-weight: 600;">
        Suivant ‚Üí
      </span>
    {% endif %}
  </div>

  <!-- Informations sur les r√©sultats -->
  <p style="margin-top: 16px; color: var(--muted); font-size: 0.9rem;">
    Page {{ pagination.page }} sur {{ pagination.pages }} ({{ pagination.total }} annonce{{ 's' if pagination.total > 1 else '' }})
  </p>
</nav>
{% endif %}

{% endblock %}
