{% extends "base.html" %}
{% block title %}Créer un compte - Spectacle'ment VØtre{% endblock %}

{% block content %}
<div class="demande-wrap" style="max-width:700px;">
  <h1 style="margin:0 0 8px 0;">Créer un compte</h1>
  <p class="text-muted" style="margin:0 0 16px 0;">
    Inscrivez-vous gratuitement pour publier vos spectacles et animations. Les champs marqués <span style="color:var(--primary); font-weight:700;">*</span> sont obligatoires.
  </p>

  <div style="background:#fffde7;border:1px solid #ffe082;padding:14px 18px;margin-bottom:20px;border-radius:10px;font-size:0.95rem;line-height:1.6;color:#795548;">
    <strong>• Publication 100 % gratuite et visibilité renforcée :</strong> vØtre spectacle est mis en ligne sans frais, avec un placement privilégié auprès de notre réseau d'acheteurs. Notre équipe s'occupe ensuite des demandes, des contacts et des ventes, sans commission tant qu'aucune réservation n'est conclue.<br>
    • Diffusion gratuite de vos projets auprès de plus de 100 000 contacts professionnels grâce à des campagnes de mails annuelles.
  </div>

  <form method="post" class="form demande-form" novalidate>
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    
    <fieldset class="demande-section">
      <legend>Identifiants</legend>

      <div class="grid-2">
        <label>
          <span class="label-text">Nom d'utilisateur <span class="req">*</span></span>
          <input type="text" name="username" required placeholder="Votre nom d'utilisateur"
                 value="{{ request.form.get('username','') }}">
        </label>

        <label>
          <span class="label-text">Email <span class="req">*</span></span>
          <input type="email" name="email" required placeholder="votre@email.fr"
                 value="{{ request.form.get('email','') }}">
        </label>
      </div>

      <label style="margin-bottom:0; position:relative;">
        <span class="label-text">Mot de passe <span class="req">*</span></span>
        <input type="password" name="password" id="register-password" required placeholder="Choisissez un mot de passe sécurisé" style="padding-right:38px;">
        <span onclick="togglePasswordRegister()" style="position:absolute; right:10px; top:38px; cursor:pointer; color:#1976d2; font-size:1.2em; user-select:none;" title="Afficher/masquer le mot de passe">
          <svg id="eye-register" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-width="2" d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z"/><circle id="eye-dot-register" cx="12" cy="12" r="3" fill="currentColor"/></svg>
        </span>
      </label>
    <script>
    function togglePasswordRegister() {
      const input = document.getElementById('register-password');
      const eye = document.getElementById('eye-register');
      if (input.type === 'password') {
        input.type = 'text';
        eye.style.opacity = 0.5;
      } else {
        input.type = 'password';
        eye.style.opacity = 1;
      }
    }
    </script>
    </fieldset>

    <fieldset class="demande-section">
      <legend>Informations complémentaires</legend>

      <div class="grid-2">
        <label>
          <span class="label-text">Téléphone</span>
          <input type="text" name="telephone" placeholder="06 00 00 00 00"
                 value="{{ request.form.get('telephone','') }}">
        </label>

        <label>
          <span class="label-text">Raison sociale</span>
          <input type="text" name="raison_sociale" placeholder="Nom de votre compagnie"
                 value="{{ request.form.get('raison_sociale','') }}">
        </label>
      </div>

      

        <label>
          <span class="label-text">Région</span>
          <input type="text" name="region" id="region-input" placeholder="Ex: Île-de-France"
                 value="{{ request.form.get('region','') }}">
        </label>

        <div style="background:#e3f2fd; color:#1565c0; border:1px solid #90caf9; border-radius:7px; padding:7px 12px; margin:10px 0 8px 0; font-size:0.97em; font-weight:500;">
          Cliquez sur une région pour remplir automatiquement le champ ci-dessus&nbsp;:
        </div>
        <!-- Bandeau supprimé -->
        <div class="region-buttons" style="display:flex; flex-wrap:wrap; gap:6px; margin-bottom:14px; position:relative; border-radius:8px; border:1px solid #1976d2; background:linear-gradient(135deg,#162447 0%,#283e5e 100%); padding:12px 0 6px 0;">
          <div id="region-hover-banner" style="display:none; position:absolute; left:0; right:0; top:-38px; background:#fffde7; color:#795548; border:1px solid #ffe082; border-radius:7px; padding:7px 12px; font-size:0.97em; font-weight:500; z-index:10; text-align:center; pointer-events:none; transition:opacity 0.2s; opacity:0;">
            Cliquez pour sélectionner cette région
          </div>
          {% set regions = [
            'Auvergne-Rhône-Alpes', 'Bourgogne-Franche-Comté', 'Bretagne', 'Centre-Val de Loire',
            'Corse', 'Grand Est', 'Hauts-de-France', 'Île-de-France', 'Normandie',
            'Nouvelle-Aquitaine', 'Occitanie', 'Pays de la Loire', 'Provence-Alpes-Côte d\'Azur',
            'Guadeloupe', 'Martinique', 'Guyane', 'La Réunion', 'Mayotte'
          ] %}
          {% set region_colors = [
            '#e67e22', '#8e44ad', '#e74c3c', '#2980b9', '#16a085', '#f1c40f', '#2ecc71', '#e84393',
            '#34495e', '#00b894', '#fdcb6e', '#00bfff', '#636e72', '#ff7675', '#00cec9', '#e17055', '#0984e3', '#b2bec3'
          ] %}
          {% for reg in regions %}
            {% set color = region_colors[loop.index0 % region_colors|length] %}
            <button type="button" class="btn-region" style="padding:4px 10px; border-radius:5px; border:1px solid {{ color }}; background:linear-gradient(135deg,{{ color }} 0%,#fff 100%); color:#222; font-size:0.95em; cursor:pointer; font-weight:600; box-shadow:0 2px 8px {{ color }}44; transition:all 0.2s;"
              onmouseover="document.getElementById('region-hover-banner').style.display='block'; document.getElementById('region-hover-banner').style.opacity='1';"
              onmouseout="document.getElementById('region-hover-banner').style.opacity='0'; setTimeout(function(){document.getElementById('region-hover-banner').style.display='none';},200);"
              onclick="document.getElementById('region-input').value='{{ reg }}'"
            >{{ reg }}</button>
          {% endfor %}
        </div>

        <label>
          <span class="label-text">Site internet</span>
             <input type="url" name="site_internet" placeholder="https://www.monsite.fr"
               value="{{ request.form.get('site_internet','') }}">
        </label>
      </div>
    </fieldset>

    <div class="demande-actions">
      <button type="submit" class="publish-btn" style="width:100%; padding:14px; font-size:1rem;">
        S'inscrire
      </button>
      
      <div style="display:flex; gap:12px; margin-top:12px;">
        <a class="btn-secondary" href="{{ url_for('login') }}" 
           style="flex:1; padding:10px; border-radius:8px; background:#23232a; color:var(--text); text-decoration:none; display:block; text-align:center; border:1px solid var(--border);">
          Annuler
        </a>
      </div>

      <p class="text-muted" style="margin:16px 0 0 0; font-size:0.85rem; text-align:center;">
        Déjà un compte ? <a href="{{ url_for('login') }}" style="color:var(--primary); text-decoration:underline;">Se connecter</a>
      </p>
    </div>
  </form>
</div>

{# Hide SEO block and footer on register page #}
<style>
  main.container .seo-block { display: none; }
  .site-footer { display: none; }
</style>

<script>
// Mapping des grandes villes françaises vers leurs régions
const villeVersRegion = {
    // Île-de-France
    'paris': 'Île-de-France',
    'boulogne-billancourt': 'Île-de-France',
    'saint-denis': 'Île-de-France',
    'argenteuil': 'Île-de-France',
    'montreuil': 'Île-de-France',
    'nanterre': 'Île-de-France',
    'créteil': 'Île-de-France',
    'versailles': 'Île-de-France',
    'vitry-sur-seine': 'Île-de-France',
    'colombes': 'Île-de-France',
    'asnières-sur-seine': 'Île-de-France',
    'courbevoie': 'Île-de-France',
    'aulnay-sous-bois': 'Île-de-France',
    'rueil-malmaison': 'Île-de-France',
    'champigny-sur-marne': 'Île-de-France',
    'aubervilliers': 'Île-de-France',
    'drancy': 'Île-de-France',
    'noisy-le-grand': 'Île-de-France',
    'levallois-perret': 'Île-de-France',
    'issy-les-moulineaux': 'Île-de-France',
    'cergy': 'Île-de-France',
    'evry': 'Île-de-France',
    'meaux': 'Île-de-France',
    'melun': 'Île-de-France',
    
    // Auvergne-Rhône-Alpes
    'lyon': 'Auvergne-Rhône-Alpes',
    'villeurbanne': 'Auvergne-Rhône-Alpes',
    'saint-etienne': 'Auvergne-Rhône-Alpes',
    'grenoble': 'Auvergne-Rhône-Alpes',
    'clermont-ferrand': 'Auvergne-Rhône-Alpes',
    'annecy': 'Auvergne-Rhône-Alpes',
    'valence': 'Auvergne-Rhône-Alpes',
    'chambery': 'Auvergne-Rhône-Alpes',
    'bourg-en-bresse': 'Auvergne-Rhône-Alpes',
    'roanne': 'Auvergne-Rhône-Alpes',
    'vienne': 'Auvergne-Rhône-Alpes',
    'annemasse': 'Auvergne-Rhône-Alpes',
    'thonon-les-bains': 'Auvergne-Rhône-Alpes',
    'aurillac': 'Auvergne-Rhône-Alpes',
    'le puy-en-velay': 'Auvergne-Rhône-Alpes',
    
    // Provence-Alpes-Côte d'Azur
    'marseille': "Provence-Alpes-Côte d'Azur",
    'nice': "Provence-Alpes-Côte d'Azur",
    'toulon': "Provence-Alpes-Côte d'Azur",
    'aix-en-provence': "Provence-Alpes-Côte d'Azur",
    'avignon': "Provence-Alpes-Côte d'Azur",
    'antibes': "Provence-Alpes-Côte d'Azur",
    'cannes': "Provence-Alpes-Côte d'Azur",
    'la seyne-sur-mer': "Provence-Alpes-Côte d'Azur",
    'hyeres': "Provence-Alpes-Côte d'Azur",
    'frejus': "Provence-Alpes-Côte d'Azur",
    'arles': "Provence-Alpes-Côte d'Azur",
    'grasse': "Provence-Alpes-Côte d'Azur",
    'martigues': "Provence-Alpes-Côte d'Azur",
    'aubagne': "Provence-Alpes-Côte d'Azur",
    'gap': "Provence-Alpes-Côte d'Azur",
    'digne-les-bains': "Provence-Alpes-Côte d'Azur",
    
    // Nouvelle-Aquitaine
    'bordeaux': 'Nouvelle-Aquitaine',
    'limoges': 'Nouvelle-Aquitaine',
    'poitiers': 'Nouvelle-Aquitaine',
    'merignac': 'Nouvelle-Aquitaine',
    'pessac': 'Nouvelle-Aquitaine',
    'pau': 'Nouvelle-Aquitaine',
    'la rochelle': 'Nouvelle-Aquitaine',
    'angouleme': 'Nouvelle-Aquitaine',
    'bayonne': 'Nouvelle-Aquitaine',
    'brive-la-gaillarde': 'Nouvelle-Aquitaine',
    'niort': 'Nouvelle-Aquitaine',
    'perigueux': 'Nouvelle-Aquitaine',
    'agen': 'Nouvelle-Aquitaine',
    'mont-de-marsan': 'Nouvelle-Aquitaine',
    'biarritz': 'Nouvelle-Aquitaine',
    'arcachon': 'Nouvelle-Aquitaine',
    
    // Occitanie
    'toulouse': 'Occitanie',
    'montpellier': 'Occitanie',
    'nimes': 'Occitanie',
    'perpignan': 'Occitanie',
    'beziers': 'Occitanie',
    'narbonne': 'Occitanie',
    'carcassonne': 'Occitanie',
    'albi': 'Occitanie',
    'tarbes': 'Occitanie',
    'castres': 'Occitanie',
    'sete': 'Occitanie',
    'montauban': 'Occitanie',
    'ales': 'Occitanie',
    'rodez': 'Occitanie',
    'cahors': 'Occitanie',
    'auch': 'Occitanie',
    'mende': 'Occitanie',
    'foix': 'Occitanie',
    
    // Grand Est
    'strasbourg': 'Grand Est',
    'reims': 'Grand Est',
    'metz': 'Grand Est',
    'mulhouse': 'Grand Est',
    'nancy': 'Grand Est',
    'colmar': 'Grand Est',
    'troyes': 'Grand Est',
    'charleville-mezieres': 'Grand Est',
    'chalons-en-champagne': 'Grand Est',
    'epinal': 'Grand Est',
    'thionville': 'Grand Est',
    'haguenau': 'Grand Est',
    'saint-dizier': 'Grand Est',
    'bar-le-duc': 'Grand Est',
    'verdun': 'Grand Est',
    
    // Hauts-de-France
    'lille': 'Hauts-de-France',
    'amiens': 'Hauts-de-France',
    'roubaix': 'Hauts-de-France',
    'dunkerque': 'Hauts-de-France',
    'tourcoing': 'Hauts-de-France',
    'calais': 'Hauts-de-France',
    'douai': 'Hauts-de-France',
    'lens': 'Hauts-de-France',
    'valenciennes': 'Hauts-de-France',
    'beauvais': 'Hauts-de-France',
    'arras': 'Hauts-de-France',
    'saint-quentin': 'Hauts-de-France',
    'compiegne': 'Hauts-de-France',
    'boulogne-sur-mer': 'Hauts-de-France',
    'laon': 'Hauts-de-France',
    'soissons': 'Hauts-de-France',
    
    // Pays de la Loire
    'nantes': 'Pays de la Loire',
    'angers': 'Pays de la Loire',
    'le mans': 'Pays de la Loire',
    'saint-nazaire': 'Pays de la Loire',
    'la roche-sur-yon': 'Pays de la Loire',
    'cholet': 'Pays de la Loire',
    'laval': 'Pays de la Loire',
    'saumur': 'Pays de la Loire',
    'les sables-d\'olonne': 'Pays de la Loire',
    
    // Bretagne
    'rennes': 'Bretagne',
    'brest': 'Bretagne',
    'quimper': 'Bretagne',
    'lorient': 'Bretagne',
    'vannes': 'Bretagne',
    'saint-brieuc': 'Bretagne',
    'saint-malo': 'Bretagne',
    'lanester': 'Bretagne',
    'fougeres': 'Bretagne',
    'concarneau': 'Bretagne',
    'morlaix': 'Bretagne',
    
    // Normandie
    'le havre': 'Normandie',
    'rouen': 'Normandie',
    'caen': 'Normandie',
    'cherbourg': 'Normandie',
    'evreux': 'Normandie',
    'dieppe': 'Normandie',
    'alencon': 'Normandie',
    'lisieux': 'Normandie',
    'saint-lo': 'Normandie',
    'argentan': 'Normandie',
    'granville': 'Normandie',
    'honfleur': 'Normandie',
    'deauville': 'Normandie',
    
    // Centre-Val de Loire
    'tours': 'Centre-Val de Loire',
    'orleans': 'Centre-Val de Loire',
    'bourges': 'Centre-Val de Loire',
    'blois': 'Centre-Val de Loire',
    'chartres': 'Centre-Val de Loire',
    'chateauroux': 'Centre-Val de Loire',
    'joue-les-tours': 'Centre-Val de Loire',
    'dreux': 'Centre-Val de Loire',
    'vierzon': 'Centre-Val de Loire',
    'montargis': 'Centre-Val de Loire',
    'amboise': 'Centre-Val de Loire',
    'chinon': 'Centre-Val de Loire',
    
    // Bourgogne-Franche-Comté
    'dijon': 'Bourgogne-Franche-Comté',
    'besancon': 'Bourgogne-Franche-Comté',
    'belfort': 'Bourgogne-Franche-Comté',
    'chalon-sur-saone': 'Bourgogne-Franche-Comté',
    'auxerre': 'Bourgogne-Franche-Comté',
    'nevers': 'Bourgogne-Franche-Comté',
    'macon': 'Bourgogne-Franche-Comté',
    'montbeliard': 'Bourgogne-Franche-Comté',
    'sens': 'Bourgogne-Franche-Comté',
    'le creusot': 'Bourgogne-Franche-Comté',
    'dole': 'Bourgogne-Franche-Comté',
    'lons-le-saunier': 'Bourgogne-Franche-Comté',
    'vesoul': 'Bourgogne-Franche-Comté',
    
    // Corse
    'ajaccio': 'Corse',
    'bastia': 'Corse',
    'porto-vecchio': 'Corse',
    'corte': 'Corse',
    'calvi': 'Corse',
    'bonifacio': 'Corse',
    
    // DOM-TOM
    'fort-de-france': 'Martinique',
    'le lamentin': 'Martinique',
    'pointe-a-pitre': 'Guadeloupe',
    'les abymes': 'Guadeloupe',
    'cayenne': 'Guyane',
    'saint-denis': 'La Réunion',
    'saint-pierre': 'La Réunion',
    'le port': 'La Réunion',
    'mamoudzou': 'Mayotte'
};

// Fonction de normalisation des villes
function normaliserVille(ville) {
    return ville.toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '')  // Retire les accents
        .replace(/[^a-z\s-]/g, '')  // Garde lettres, espaces et tirets
        .trim();
}

// Auto-complétion de la région quand on entre une ville
document.addEventListener('DOMContentLoaded', function() {
    // Chercher tous les champs qui pourraient contenir une ville
    const villeInputs = document.querySelectorAll('input[name="location"], input[name="lieu"], input[name="ville"]');
    const regionInput = document.getElementById('region-input');
    
    if (regionInput) {
        villeInputs.forEach(function(input) {
            input.addEventListener('blur', function() {
                const ville = normaliserVille(this.value);
                if (ville && villeVersRegion[ville]) {
                    // Proposer d'auto-remplir la région si elle est vide
                    if (!regionInput.value) {
                        regionInput.value = villeVersRegion[ville];
                        regionInput.style.transition = 'background 0.3s';
                        regionInput.style.background = '#d4edda';
                        setTimeout(() => { regionInput.style.background = ''; }, 1500);
                    }
                }
            });
        });
        
        // Aussi écouter le champ région lui-même pour proposer des régions si l'utilisateur tape une ville
        regionInput.addEventListener('input', function() {
            const val = normaliserVille(this.value);
            if (val.length >= 3 && villeVersRegion[val]) {
                // L'utilisateur a tapé le nom d'une ville, proposer la région
                this.value = villeVersRegion[val];
                this.style.background = '#d4edda';
                setTimeout(() => { this.style.background = ''; }, 1500);
            }
        });
    }
});
</script>
{% endblock %}
