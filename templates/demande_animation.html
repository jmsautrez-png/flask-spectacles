{% extends "base.html" %}
{% block title %}Demander une animation pour anniversaire, entreprise, école - Spectacle'ment VØtre{% endblock %}

{% block content %}
<div style="margin-bottom:18px; font-size:1.15em; color:#fff; font-weight:600; text-align:center;">
  Spectacle'ment VØtre la plateforme qui connecte facilement les organisateurs d’événements avec des artistes et compagnies de spectacle vivant.
</div>
<div class="demande-wrap" style="background:linear-gradient(135deg,#1b2a4e 0%,#355c7d 100%); border:2px solid #355c7d; border-radius:16px; padding:32px; margin-bottom:32px; position:relative; overflow:hidden; box-shadow:0 4px 16px #355c7d22; color:#fff;">
  <div style="background:linear-gradient(90deg,#1b2a4e 0%,#355c7d 100%); color:#fff; border-radius:10px; padding:14px 18px; margin-bottom:18px; text-align:center; font-size:1.18em; font-weight:700; box-shadow:0 2px 8px #1b2a4e33; letter-spacing:0.1px;">
    Demande d'un devis, d'une animation ou d'un spectacle
  </div>
  <p class="text-muted" style="margin:0 0 24px 0; text-align:center;">
    Remplissez les informations essentielles. Les champs marqués <span style="color:var(--primary); font-weight:700;">*</span> sont obligatoires.<br>
    <span style="display:block; margin-top:10px; font-size:0.95em; color:hsl(210, 12%, 97%);">Votre demande sera envoyée à tout nos abonnés</span>
  </p>

  <form action="{{ url_for('demande_animation') }}" method="POST" class="form demande-form" novalidate>
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
      <input type="hidden" name="auto_datetime" id="auto_datetime" value="">
    
    <fieldset class="demande-section">
      <legend>1) Vos coordonnées</legend>

      <div class="grid-2">
        <label>
          <span class="label-text">Structure / Organisateur <span class="req">*</span></span>
          <input type="text" id="structure" name="structure" required autocomplete="organization"
                 placeholder="Mairie, école, association…"
                 value="{{ request.form.get('structure','') }}">
          <small class="hint">Ex : Mairie de X, École Y, Association Z…</small>
        </label>

        <label>
          <span class="label-text">Nom / Prénom (contact principal) <span class="req">*</span></span>
          <input type="text" id="nom" name="nom" required autocomplete="name"
                 placeholder="Votre nom"
                 value="{{ request.form.get('nom','') }}">
        </label>
      </div>

      <div class="grid-2">
        <label>
          <span class="label-text">E-mail de contact <span class="req">*</span></span>
          <input type="email" id="contact_email" name="contact_email" required autocomplete="email"
                 placeholder="votre@email.fr"
                 value="{{ request.form.get('contact_email','') }}">
          <small class="hint">Nous l'utilisons uniquement pour répondre à votre demande.</small>
        </label>

        <label>
          <span class="label-text">Téléphone <span class="req">*</span></span>
          <input type="tel" id="telephone" name="telephone" required autocomplete="tel"
                 inputmode="tel" placeholder="06 00 00 00 00"
                 value="{{ request.form.get('telephone','') }}">
        </label>
      </div>
    </fieldset>

    <fieldset class="demande-section">
      <legend>2) Votre événement</legend>

      <div class="grid-2">
        <label>
          <span class="label-text">Lieu / Ville <span class="req">*</span></span>
          <input type="text" id="lieu_ville" name="lieu_ville" required autocomplete="address-level2"
                 placeholder="Paris, Lyon…"
                 value="{{ request.form.get('lieu_ville','') }}">
        </label>

        <label>
          <span class="label-text">Date(s) et horaires <span class="req">*</span></span>
          <input type="text" id="dates_horaires" name="dates_horaires" required
                 placeholder="Ex : 15/12 (14h-16h), 18/12 (10h-12h)"
                 value="{{ request.form.get('dates_horaires','') }}">
        </label>
      </div>

      <div class="grid-2">
        <label>
          <span class="label-text">Genre recherché <span class="req">*</span></span>
          <select id="genre_recherche" name="genre_recherche" required>
            <option value="">-- Choisir --</option>
            <optgroup label="Spectacle et Animation Artistique">
              <option value="Spectacle Maternelle">Spectacle Maternelle</option>
              <option value="Spectacle Élémentaire">Spectacle Élémentaire</option>
              <option value="Spectacle École">Spectacle École</option>
              <option value="Spectacle CSE">Spectacle CSE</option>
              <option value="Festival">Festival</option>
              <option value="Fêtes Foraine">Fête Foraine</option>
              <option value="Sculpteur de ballons">Sculpteur de ballons</option>
              <option value="Animation et Atelier Artistique">Animation et Atelier Artistique</option>
              <option value="Atelier divers">Atelier divers</option>
              <option value="Atelier maquillage">Atelier maquillage</option>
              <option value="Caricaturistes et Silhouettiste">Caricaturistes et Silhouettiste</option>
              <option value="Cirque">Cirque</option>
              <option value="Clown">Clown</option>
              <option value="Conte et Théâtre">Conte et Théâtre</option>
              <option value="Fête de village">Fête de village</option>
              <option value="Humoriste et Imitateur">Humoriste et Imitateur</option>
              <option value="Location de stand">Location de stand</option>
              <option value="Magie et Magicien">Magie et Magicien</option>
              <option value="Manège">Manège</option>
              <option value="Marionnettes">Marionnettes</option>
              <option value="Père Noël">Père Noël</option>
              <option value="Revue Cabaret et Danse">Revue Cabaret et Danse</option>
              <option value="Sosie">Sosie</option>
              <option value="Spectacle à Thèmes">Spectacle à Thèmes</option>
              <option value="Spectacle Animalier">Spectacle Animalier</option>
              <option value="Spectacle Arbre de Noël">Spectacle Arbre de Noël</option>
              <option value="Spectacle de danse">Spectacle de danse</option>
              <option value="Spectacle de Rue">Spectacle de Rue</option>
              <option value="Spectacle Enfants">Spectacle Enfants</option>
              <option value="Spectacle Evénementiel">Spectacle Evénementiel</option>
              <option value="Spectacle Musical">Spectacle Musical</option>
              <option value="Ventriloque">Ventriloque</option>
            </optgroup>
            <optgroup label="Groupe de Musique et Musicien">
              <option value="Accordéoniste">Accordéoniste</option>
              <option value="Animation Musicale">Animation Musicale</option>
              <option value="Chorale et Gospel">Chorale et Gospel</option>
              <option value="D.J. et Orchestre">D.J. et Orchestre</option>
              <option value="Fanfare et Batucada">Fanfare et Batucada</option>
              <option value="Groupe folklorique">Groupe folklorique</option>
              <option value="Jazz">Jazz</option>
              <option value="Musique Classique">Musique Classique</option>
              <option value="Orgue de Barbarie">Orgue de Barbarie</option>
              <option value="Pianiste">Pianiste</option>
              <option value="Rock et Country">Rock et Country</option>
            </optgroup>
            <option value="Autre">Autre (précisez ci-dessous)</option>
          </select>
        </label>

        <label id="autre_genre_container" style="display:none;">
          <span class="label-text">Précisez votre demande</span>
          <input type="text" id="autre_genre" name="autre_genre" placeholder="Décrivez le type de spectacle ou animation recherché">
          <small class="hint">Ce champ sera utilisé si vous sélectionnez "Autre" ci-dessus.</small>
        </label>

        <label>
          <span class="label-text">Tranche d'âge du public <span class="req">*</span></span>
          <select id="age_range" name="age_range" required>
            <option value="">-- Choisir --</option>
            <option value="enfant" {% if request.form.get('age_range','') == 'enfant' %}selected{% endif %}>Enfant</option>
            <option value="enfant_2_6" {% if request.form.get('age_range','') == 'enfant_2_6' %}selected{% endif %}>Enfant (2/6ans)</option>
            <option value="enfant_5_10" {% if request.form.get('age_range','') == 'enfant_5_10' %}selected{% endif %}>Enfant (5/10ans)</option>
            <option value="enfants_2_10" {% if request.form.get('age_range','') == 'enfants_2_10' %}selected{% endif %}>Enfants (2/10ans)</option>
            <option value="adulte" {% if request.form.get('age_range','') == 'adulte' %}selected{% endif %}>Adulte</option>
            <option value="tout public" {% if request.form.get('age_range','') == 'tout public' %}selected{% endif %}>Tout public</option>
          </select>
          <small class="hint">Aide au choix de l'artiste / spectacle.</small>
        </label>
      </div>

      <div class="grid-2">
        <label>
          <span class="label-text">Jauge estimée <span class="req">*</span></span>
          <input type="number" id="jauge" name="jauge" min="1" step="1" required inputmode="numeric"
                 placeholder="Ex : 120"
                 value="{{ request.form.get('jauge','') }}">
        </label>

        <label>
          <span class="label-text">Budget indicatif <span class="req">*</span></span>
          <input type="text" id="budget" name="budget" required
                 placeholder="Ex : 1000–1500 €"
                 value="{{ request.form.get('budget','') }}">
          <small class="hint">Même une fourchette aide à proposer les bonnes options.</small>
        </label>
      </div>
    </fieldset>

    <fieldset class="demande-section">
      <legend>3) L'espace / contraintes</legend>

      <label style="margin-bottom: 0;">
        <span class="label-text">Type d'espace mis à disposition <span class="req">*</span></span>
        <input type="text" id="type_espace" name="type_espace" required
               placeholder="Salle polyvalente, gymnase, plein air…"
               value="{{ request.form.get('type_espace','') }}">
      </label>

      <details class="demande-details">
        <summary>▸ Ajouter des précisions (optionnel)</summary>
        <div class="grid-2" style="margin-top:16px;">
          <label>
            <span class="label-text">Contraintes techniques</span>
            <textarea id="contraintes" name="contraintes" rows="4"
                      placeholder="Scène, hauteur sous plafond, noir total, régie, puissance électrique…">{{ request.form.get('contraintes','') }}</textarea>
          </label>

          <label>
            <span class="label-text">Accessibilité</span>
            <textarea id="accessibilite" name="accessibilite" rows="4"
                      placeholder="PMR, parking, déchargement, ascenseur…">{{ request.form.get('accessibilite','') }}</textarea>
          </label>
        </div>
      </details>
    </fieldset>

    <div class="demande-actions">
      <button type="submit" class="publish-btn" style="width:100%; padding:14px; font-size:1rem;">
        Envoyer la demande
      </button>
      <span style="display:block; margin-top:10px; font-size:0.95em; color:#b0b8d8; text-align:center;">Réponse rapide — vous serez contacté par e-mail / téléphone.</span>
    </div>
  </form>

  <script>
  // Remplit le champ caché auto_datetime avec la date et l'heure locale au chargement du formulaire
  document.addEventListener('DOMContentLoaded', function() {
    var now = new Date();
    var formatted = now.toLocaleDateString('fr-FR') + ' ' + now.toLocaleTimeString('fr-FR');
    var input = document.getElementById('auto_datetime');
    if (input) {
      input.value = formatted;
    }

    // Gestion de l'affichage du champ "Autre genre"
    var genreSelect = document.getElementById('genre_recherche');
    var autreContainer = document.getElementById('autre_genre_container');
    var autreInput = document.getElementById('autre_genre');
    
    if (genreSelect && autreContainer) {
      genreSelect.addEventListener('change', function() {
        if (this.value === 'Autre') {
          autreContainer.style.display = 'block';
          autreInput.setAttribute('required', 'required');
        } else {
          autreContainer.style.display = 'none';
          autreInput.removeAttribute('required');
          autreInput.value = '';
        }
      });
    }
  });
  </script>
</div>

{# Hide SEO block on this conversion-focused page #}
<style>
    .demande-form input,
    .demande-form textarea,
    .demande-form select {
      background:linear-gradient(135deg,#22335a 0%,#2d4263 100%);
      color:#fff;
      border:1.5px solid #355c7d;
      border-radius:8px;
      font-size:1rem;
      font-family:inherit;
      padding:12px 16px;
      transition:all 0.2s;
      box-shadow:0 1px 4px #16244722;
    }
    .demande-form input:focus,
    .demande-form textarea:focus,
    .demande-form select:focus {
      outline:none;
      border-color:#1976d2;
      box-shadow:0 0 0 3px #1976d244;
    }
    .demande-form input::placeholder,
    .demande-form textarea::placeholder {
      color:#b0b8d8;
      opacity:0.8;
    }
  main.container .seo-block { display: none; }
</style>
{% endblock %}
